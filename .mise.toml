[tools]
bun = "1.3.5"
node = "24.11.1"

[env]
NODE_OPTIONS = "--no-deprecation"
PROD_COMPOSE_ARGS = "--env-file .env.production -f compose.prod.yaml"

[tasks.check]
description = "開発環境が整っているか（Docker起動状況や設定ファイル）を検証"
run = "bun scripts/check-env.ts"

[tasks.install]
description = "ロックファイルに変更があった場合のみ依存関係をインストール"
run = "bun install --frozen-lockfile"
sources = ["bun.lock", "package.json"]

[tasks."dev:db"]
description = "PostgreSQL (DB) のみを開始"
run = "docker compose up -d postgres"

[tasks."dev:db:stop"]
description = "PostgreSQL を停止"
run = "docker compose stop postgres"

[tasks."reset:db"]
description = "開発用DBのデータを削除して作り直す（リセット）"
run = "bun scripts/reset-db.ts"

[tasks.dev]
description = "DockerとNext.jsサーバーを起動 (Ctrl+C終了時にコンテナも自動停止)"
depends = ["install", "check"]
run = "bun scripts/dev.ts"

[tasks."prod:up"]
description = "本番環境をビルドして起動"
run = "bun scripts/prod.ts up"

[tasks."prod:down"]
description = "本番環境を停止"
run = "bun scripts/prod.ts down"

[tasks."reset:db:prod"]
description = "本番用DBデータを削除して再構築"
run = "bun scripts/prod.ts reset"
